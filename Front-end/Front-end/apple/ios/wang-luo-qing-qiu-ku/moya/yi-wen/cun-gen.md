# 存根

在 Moya 中，**存根行为类型**（`StubBehavior`）指的是在<mark style="color:red;">开发和测试阶段</mark>，通过模拟网络请求的响应来代替实际的网络请求，以便你无需依赖真实的后端 API。这种行为通常称为“存根”或“Stub”，即用预定义的假数据来代替真实的数据。

`StubBehavior` 的主要作用是帮助开发者在以下场景中使用：

* **测试网络层**：在测试中，可以通过 Stub 返回预设的响应，避免实际的网络请求，这样测试可以更快、更稳定，并且不受外部网络因素影响。
* **开发阶段**：在后端 API 尚未准备好或不稳定时，前端开发者可以通过预定义的响应数据继续开发，确保前后端开发的并行进行。

#### Moya 的 `StubBehavior` 类型

在 Moya 中，`StubBehavior` 是一个枚举，定义了几种不同的存根行为：

1. **`.never`**：
   * 表示永远不使用存根行为，这意味着每次都会进行实际的网络请求。这是默认的行为。
2. **`.immediate`**：
   * 表示立即返回存根的响应数据，不进行真实的网络请求。适用于模拟网络请求的结果，且无需延迟。
3. **`.delayed(seconds)`**：
   * 表示在指定的时间延迟后返回存根响应数据。这模拟了真实的网络请求延迟，适用于需要模拟真实环境中的网络延迟的场景。
   * 例如：`.delayed(2)` 表示在 2 秒后返回模拟的响应数据。

#### 例子

```swift
let provider = MoyaProvider<MyService>(stubClosure: MoyaProvider.immediatelyStub)

// 或者延迟2秒返回存根数据
let provider = MoyaProvider<MyService>(stubClosure: MoyaProvider.delayedStub(2))
```

在上述示例中，`immediatelyStub` 会立即返回假数据，而 `delayedStub(2)` 会在 2 秒后返回假数据，这样的设计能够灵活地模拟不同的网络环境。

#### 存根行为的典型应用场景

1. **测试环境**：
   * 在测试时使用 `StubBehavior` 返回预设数据，而不需要调用真实的 API。例如，在单元测试中，你可以指定预期的响应，从而验证请求的逻辑或 UI 的反应，而不必依赖网络连接和后端服务器。
2. **开发阶段**：
   * 在后端 API 尚未完成时，通过 `StubBehavior` 模拟 API 返回的数据，继续前端开发工作。
3. **模拟错误状态**：
   * 你可以用存根来模拟网络错误、超时等场景，以便测试客户端在这些异常情况下的表现。

#### 小结

Moya 中的 `StubBehavior` 提供了一种简单而强大的方式来模拟网络请求，通过返回预设的响应数据，开发者可以减少对实际 API 的依赖，从而更快地进行开发和测试。这对于测试网络层逻辑、处理网络错误以及开发 API 尚未完成的功能都非常有帮助。
