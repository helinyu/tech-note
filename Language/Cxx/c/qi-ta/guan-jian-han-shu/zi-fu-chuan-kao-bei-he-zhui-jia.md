# 字符串拷贝和追加

以下是 `strcpy`、`strlcpy`、`stpcpy`、`strncpy`、`stpncpy`、`strcat`、`strlcat` 和 `strncat` 函数的关系、区别及注意事项的表格：

| **函数**    | **功能**                                                      | **返回值**                         | **适用场景**                        | **注意事项**                                                   |
| --------- | ----------------------------------------------------------- | ------------------------------- | ------------------------------- | ---------------------------------------------------------- |
| `strcpy`  | 将源字符串复制到目标字符串，包括终止符 `\0`。                                   | 返回目标字符串的指针。                     | 简单字符串复制，假设目标空间足够大。              | 如果目标缓冲区不够大，可能会造成缓冲区溢出，未检查目标大小。                             |
| `strlcpy` | 将源字符串复制到目标字符串，确保目标字符串的长度不超过指定大小，且会保证以 `\0` 结尾。              | 返回源字符串的长度，不包括终止符。               | 需要避免目标缓冲区溢出时使用，适合需要明确指定目标大小的情况。 | GNU 库不标准，跨平台时可能不可用。目标大小必须手动提供，且返回值为源字符串的长度，需检查是否发生截断。      |
| `stpcpy`  | 类似于 `strcpy`，但返回指向目标字符串结尾的指针（即指向复制的 `\0`）。                  | 返回指向目标字符串终止符的指针。                | 在复制字符串后希望立即访问目标字符串结尾时使用。        | 和 `strcpy` 一样，未检查目标大小，可能导致缓冲区溢出。                           |
| `strncpy` | 将源字符串的前 `n` 个字符复制到目标字符串，若源字符串长度不足 `n`，则填充 `\0`。             | 返回目标字符串的指针。                     | 在只需要复制部分字符串时使用，如有特定长度要求的操作。     | 若源字符串长度超过 `n`，不会自动加上终止符，目标字符串可能不是以 `\0` 结尾，需手动处理终止符。       |
| `stpncpy` | 类似于 `strncpy`，但返回指向目标字符串结尾的指针（即指向复制的 `\0` 或 `n` 个字符之后）。     | 返回指向目标字符串的指针，指向终止符或复制的最后一个字符后面。 | 在复制字符串并需要访问目标结尾时使用，且只复制指定长度。    | 与 `strncpy` 相同的问题：如果源字符串长度超过 `n`，不会自动添加终止符，目标可能不是 `\0` 结尾。 |
| `strcat`  | 将源字符串追加到目标字符串的末尾，目标字符串必须以 `\0` 结尾。                          | 返回目标字符串的指针。                     | 将一个字符串附加到另一个字符串的末尾时使用。          | 如果目标缓冲区不够大，可能导致缓冲区溢出，未检查目标的剩余空间。                           |
| `strlcat` | 将源字符串追加到目标字符串的末尾，最多追加到目标字符串指定的大小（包括 `\0`），确保目标字符串以 `\0` 结尾。 | 返回目标字符串长度。                      | 安全的字符串连接操作，适用于需要控制目标缓冲区大小的情况。   | GNU 库不标准，跨平台时可能不可用。目标大小必须手动提供，若返回值大于或等于目标大小，表示目标被截断。       |
| `strncat` | 将源字符串的前 `n` 个字符追加到目标字符串的末尾，目标字符串必须以 `\0` 结尾，手动控制追加的字符数量。    | 返回目标字符串的指针。                     | 需要控制追加字符数量时使用，如只追加源字符串的一部分。     | 如果目标缓冲区空间不足以容纳追加的字符，可能导致缓冲区溢出。                             |

#### 主要区别总结：

1. **复制类函数：**
   * **`strcpy`** 和 **`strlcpy`** 都是字符串复制函数，`strcpy` 不检查目标大小，而 `strlcpy` 通过提供目标大小来避免溢出。
   * **`stpcpy`** 类似于 `strcpy`，但返回指向复制后终止符的指针，便于直接访问字符串末尾。
   * **`strncpy`** 和 **`stpncpy`** 是带有长度控制的复制函数，适合部分字符串复制，其中 `stpncpy` 还会返回指向复制结束后的指针。
2. **追加类函数：**
   * **`strcat`** 和 **`strlcat`** 都是用于字符串追加操作的函数，`strcat` 不检查目标大小，可能导致溢出，而 `strlcat` 可以指定目标大小。
   * **`strncat`** 限制了追加的源字符串长度，确保不会超过指定字符数。

#### 注意事项：

* **缓冲区溢出**：`strcpy`、`stpcpy`、`strcat` 和 `strncat` 不会检查目标缓冲区大小，必须确保目标缓冲区足够大，以避免溢出。
* **终止符问题**：`strncpy` 和 `stpncpy` 可能不会自动添加 `\0`，因此在使用时需要手动检查并确保目标字符串有正确的终止符。
* **跨平台支持**：`strlcpy` 和 `strlcat` 是非标准函数，某些平台可能不可用，使用时需注意可移植性问题。
