# 疑问

Q： C++ 中为什么要通过模板参数传递可以传过去数组的长度？在使用的时候并没有将数组长度写进去传

A： 在 C++ 中，模板有时需要接收数组的长度作为参数，原因在于 C++ 中的数组不直接存储其大小信息。为了让模板能够操作数组，并且知道其长度，数组的大小通常作为模板参数传递，这样模板可以在编译期处理数组的相关逻辑。

#### 1. **C++ 中数组不保存大小信息**

在 C++ 中，普通的原生数组（C-style arrays）只存储数据的起始地址，而**不保存**数组的长度信息。例如：

```cpp
int arr[5] = {1, 2, 3, 4, 5};
```

在这里，`arr` 只是一个指向数组首元素的指针，无法通过它直接获取数组的大小。编译器不知道数组的长度，这会在编写通用的函数时带来问题。

#### 2. **通过模板接收数组长度**

为了编写通用的模板函数，并且确保编译期知道数组的大小，通常会将数组的长度作为模板参数传递。这样可以避免在运行时计算数组长度的额外开销，同时可以实现更灵活和类型安全的代码。

**模板接受数组长度的示例**

```cpp
template <typename T, std::size_t N>
void printArray(const T (&arr)[N]) {
    for (std::size_t i = 0; i < N; ++i) {
        std::cout << arr[i] << " ";
    }
    std::cout << std::endl;
}
```

在这个例子中，模板函数 `printArray` 接收了一个数组的引用 `const T (&arr)[N]`，其中 `T` 是数组的类型，`N` 是数组的大小。这种写法让模板能够在编译时获取数组的大小。

**使用该模板**

```cpp
int main() {
    int arr[5] = {1, 2, 3, 4, 5};
    printArray(arr);  // 输出: 1 2 3 4 5
    return 0;
}
```

在这个示例中，编译器可以通过模板参数 `N` 得到数组的大小 `5`，无需在运行时进行额外的处理。

#### 3. **编译期的优化与类型安全**

通过模板传递数组的大小，C++ 编译器可以在编译期确定数组的大小，并据此生成高效的代码。这不仅提高了运行时性能，还保证了类型安全，避免数组越界等潜在问题。

**编译期检查的好处**

例如，假设我们希望编写一个获取数组大小的模板函数：

```cpp
template <typename T, std::size_t N>
constexpr std::size_t arraySize(const T (&)[N]) {
    return N;
}
```

使用时：

```cpp
int arr[5];
std::cout << arraySize(arr) << std::endl;  // 输出: 5
```

通过模板传递数组的大小，编译器能够在编译期检查是否传递了正确的数组大小，从而避免运行时的数组越界问题。

#### 4. **C++ 标准库的 `std::array` 与 `std::vector`**

虽然 C++ 原生数组无法存储自身的长度，C++ 标准库提供了 `std::array` 和 `std::vector` 来解决这个问题：

*   **`std::array`** 是一个定长数组类，它在编译期确定大小，且能够通过 `size()` 成员函数获取数组长度。

    ```cpp
    std::array<int, 5> arr = {1, 2, 3, 4, 5};
    std::cout << arr.size();  // 输出: 5
    ```
*   **`std::vector`** 是一个动态数组类，可以在运行时动态调整大小，并提供了方便的 `size()` 成员函数来获取数组大小。

    ```cpp
    std::vector<int> vec = {1, 2, 3, 4, 5};
    std::cout << vec.size();  // 输出: 5
    ```

与原生数组不同，这些容器类内部保存了数组的大小信息，因此不需要通过模板传递数组大小。

#### 总结

<mark style="color:red;">**C++ 中的模板接收数组的长度是为了在编译时确定数组的大小，使代码更高效和安全。原生数组不存储长度信息，通过将数组大小作为模板参数，编译器能够在编译期生成高效的代码并进行类型检查。**</mark>这是 C++ 中常见的泛型编程模式，尤其适用于操作定长数组的场景。

